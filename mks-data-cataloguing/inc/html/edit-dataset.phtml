<?php
wp_enqueue_script('post');
wp_enqueue_script('word-count');
wp_enqueue_script('editor');
wp_enqueue_script('media-upload');
get_header();
//wp_tiny_mce();
?>
<article id="post-<?php print get_the_ID(); ?>"
	class="page type-page status-publish entry page-dataset">
	<header class="entry-header">
		<h1 class="entry-title"><?php the_Title()?>
		<?php if($this->get('isPrivate') == TRUE): ?>
			<small class="label label-warning">Private</small>
		<?php endif; ?>
		</h1>
	</header>
	<div class="entry-content">
	<div>
	<?php $this->partial('errors-summary', $this->getAll()); ?>
			<form action="" enctype="multipart/form-data" method="POST" id="mksdc_edit_dataset" name="mksdc_edit_dataset" accept-charset="utf-8">
				<?php wp_nonce_field( 'edit-dataset_' . get_the_ID() ); ?>
				<div class="tabbable boxed parentTabs">
					<?php $this->partial('edit-tabs', $this->getAll()); ?>
					<div class="tab-content">
						<!--  General information -->
						<div class="tab-pane fade in active" id="ds-info">
							<?php $this->partial('edit-information', $this->getAll()); ?>
							<?php $this->partial('wizard-buttons', array('next'=>true,'save'=>true,'cancel'=>true)); ?>
						</div>
						<div class="tab-pane fade in" id="ds-licence">
							<?php $this->partial('edit-licence', $this->getAll()); ?>
							<?php $this->partial('wizard-buttons', array('next'=>true,'prev'=>true,'save'=>true,'cancel'=>true)); ?>
						</div>

						<?php /* Only when dataset type is 'file' */ ?>
						<?php if($this->get('managedType') == 'file'): ?>
						<div class="tab-pane fade in" id="ds-upload">
							<?php $this->partial('edit-upload', $this->getAll()); ?>
							<?php $this->partial('wizard-buttons', array('next'=>true,'prev'=>true,'save'=>true,'cancel'=>true)); ?>
						</div>
					  <?php endif; ?>

						<!-- div class="tab-pane fade in" id="ds-data"></div -->
						<!-- Other tabs here -->
						<?php /* Extend the Edit Dataset View with the 'dataset-edit-tab-content' extension */
						$extensionsNumber = count(MKSDC_Plugin::instance()->getExtensions('dataset-edit-tab'));
						foreach(MKSDC_Plugin::instance()->getExtensions('dataset-edit-tab') as $extension): ?>
							<?php unset($v); ?>
							<?php if(is_array(@$extension) && @is_object(@$extension[0])):
								$o = $extension[0];
							    $v = $o->$extension[1](); ?>
							<?php elseif(function_exists($extension)):
								$v = $extension(); ?>
							<?php endif; ?>
							<?php if($v){
								$tabId = $v[0];
							}?>
							<div class="tab-pane fade in" id="ds-<?php print $tabId; ?>">
							<?php foreach(MKSDC_Plugin::instance()->getExtensions('dataset-edit-tab-content') as $extension): ?>
							<?php unset($v); ?>
							<?php if(is_array(@$extension) && @is_object(@$extension[0])):
								$o = $extension[0];
							    $o->$extension[1]($tabId, $this->getAll()); ?>
							<?php elseif(function_exists($extension)):
								$extension($tabId, $this->getAll()); ?>
							<?php endif; ?>
							<?php endforeach; ?>
							<?php $this->partial('wizard-buttons', ($extensionsNumber==1)?array('prev'=>true, 'save'=>true,'cancel'=>true):array('next'=>true,'prev'=>true,'cancel'=>true,'save'=>true)); ?>
							<?php $extensionsNumber--; ?>
							</div>
						<?php endforeach; ?>
					</div>
				</div>
			</form>
	</div>
	</div>
	</article>
<?php get_footer(); ?>
